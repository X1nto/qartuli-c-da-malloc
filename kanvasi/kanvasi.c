#include <stdlib.h>
#include "qartuli.h"
#include "stdsheyvana.h"
#include "stdbiblioteka.h"

სტრუქტურა ტილო_ტ {
    სიმბოლო **გამოსახულება;
    მთელი ზომა;
};

სტრუქტურა ტილო_ტ ტილო;

ბათილი ჩართე_ტილო(მთელი ზომა) {
    ტილო.ზომა = ზომა;
    ტილო.გამოსახულება = (სიმბოლო **)malloc(ზომა * ამისზომა(სიმბოლო *));
    ყოველი (მთელი i = 0; i < ზომა; i++) {
        ტილო.გამოსახულება[i] = (სიმბოლო *)malloc(ზომა * ამისზომა(სიმბოლო));
        ყოველი (მთელი j = 0; j < ზომა; j++) {
            ტილო.გამოსახულება[i][j] = ' ';
        }
    }
}


ბათილი გამოსახე_ტილო(მთელი ზომა) {
    დაბეჭდეფ("  ");
    ყოველი (მთელი j = 0; j < ზომა; j++) {
        დაბეჭდეფ("%d ", j);
    }
    დაბეჭდეფ("\n");

    ყოველი (მთელი ა = 0; ა < ზომა; ა++) {
        დაბეჭდეფ("%d|", ა);
        ყოველი (მთელი ბ = 0; ბ < ზომა; ბ++) {
            დაბეჭდეფ("%c|", ტილო.გამოსახულება[ა][ბ]);
        }
        დაბეჭდეფ("\n");
    }
}


ბათილი წაშალე_ტილო(მთელი ზომა) {
    ტილო.ზომა = 0;
    ყოველი (მთელი ა = 0; ა < ზომა; ა++) {
        ყოველი (მთელი ბ = 0; ბ < ზომა; ბ++) {
            ტილო.გამოსახულება[ა][ბ] = ' ';
        }
    }
}


ბათილი დახატე_კანვასზე(მთელი სტრ, მთელი სვტ, სიმბოლო კალამი) {
    თუ (სტრ >= 0 && სტრ < ტილო.ზომა && სვტ >= 0 && სვტ < ტილო.ზომა) {
        ტილო.გამოსახულება[სტრ][სვტ] = კალამი;
    } ან {
        დაბეჭდეფ("Invalid coordinates! Row and column should be between 0 and %d.\n", ტილო.ზომა - 1);
    }
}


ბათილი გადაყრა_ტილოს(მთელი ზომა) {
    ყოველი (მთელი ა = 0; ა < ზომა; ა++) {
        გადაყრა(ტილო.გამოსახულება[ა]);
    }
    გადაყრა(ტილო.გამოსახულება);
}

მთელი მთავარი() {
    სიმბოლო კალამი = '*';
    მთელი სტრ, სვტ;
    სიმბოლო ბრძანება;

    მთელი ზომა = 5;

    დაბეჭდეფ("Enter canvas size (default is 5): ");
    თუ (დასკანეფ("%d", &ზომა) != 1 || ზომა <= 0) {
        დაბეჭდეფ("Invalid input. Using default ზომა 5.\n");
    }

    ჩართე_ტილო(ზომა);

    ვიდრე(1) {
        გამოსახე_ტილო(ზომა);

        დაბეჭდეფ("\nCommands:\n");
        დაბეჭდეფ("D <row> <col>: Draw at (row, col)\n");
        დაბეჭდეფ("C: Clear the canvas\n");
        დაბეჭდეფ("E: Exit the program\n");

        დაბეჭდეფ("Enter command: ");
        დასკანეფ(" %c", &ბრძანება);

        გადაცვლა(ბრძანება) {
            შემთხვევა 'D':
            შემთხვევა 'd':
                დაბეჭდეფ("Enter row and column: ");
                თუ (დასკანეფ("%d %d", &სტრ, &სვტ) != 2) {
                    დაბეჭდეფ("Invalid input! Please enter two integers.\n");
                    ვიდრე (მომესიმბ() != '\n');
                    გააგრძელე;
                }
                დაბეჭდეფ("Enter a character to draw: ");
                დასკანეფ(" %c", &კალამი);
                დახატე_კანვასზე(სტრ, სვტ, კალამი);
                გამოდი;
            შემთხვევა 'C':
            შემთხვევა 'c':
                წაშალე_ტილო(ზომა);
                გამოდი;
            შემთხვევა 'E':
            შემთხვევა 'e':
                გადახტი გამოსავალი;
                გამოდი;
            ნაგულისხმევი:
                დაბეჭდეფ("Invalid command! Try again.\n");
        }
    }

გამოსავალი:

    დაბეჭდეფ("Final Canvas:\n");
    გამოსახე_ტილო(ზომა);

    გადაყრა_ტილოს(ზომა);

    დააბრუნე 0;
}
